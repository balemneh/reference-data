<!-- Modern Dashboard Header -->
<div class="cbp-container">
  <div class="cbp-dashboard-header cbp-fade-in">
    <div class="cbp-dashboard-header__content">
      <div class="cbp-dashboard-header__text">
        <h1 class="cbp-dashboard-header__title cbp-text-gradient">
          Reference Data Dashboard
        </h1>
        <p class="cbp-dashboard-header__subtitle">
          Real-time insights and management for countries and reference data
        </p>
      </div>
      <div class="cbp-dashboard-header__actions">
        <div class="cbp-keyboard-hint">
          Press <kbd>Ctrl</kbd> + <kbd>K</kbd> for commands
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Error Alert -->
<div class="cbp-container" *ngIf="error">
  <div class="cbp-alert cbp-alert--error cbp-slide-up">
    <div class="cbp-alert__content">
      <svg class="cbp-alert__icon" aria-hidden="true">
        <use xlink:href="/assets/uswds/img/sprite.svg#error"></use>
      </svg>
      <div class="cbp-alert__body">
        <h4 class="cbp-alert__title">Dashboard Error</h4>
        <p class="cbp-alert__text">{{ error }}</p>
      </div>
    </div>
  </div>
</div>


<!-- Modern Enhanced Metrics Cards -->
<div class="cbp-container cbp-section">
  <div class="cbp-metrics-grid">
    <!-- Countries Card -->
    <div class="cbp-metric-card cbp-slide-up" style="animation-delay: 0.1s" *ngIf="isCardEnabled('countries')">
      <div class="cbp-metric-card__icon cbp-metric-card__icon--countries">
        <svg class="cbp-metric-icon" aria-hidden="true">
          <use xlink:href="/assets/uswds/img/sprite.svg#public"></use>
        </svg>
      </div>
      <div class="cbp-metric-card__content">
        <div class="cbp-metric-card__header">
          <h3 class="cbp-metric-card__title">Countries</h3>
          <span class="cbp-badge cbp-badge--success">Active</span>
        </div>
        <div class="cbp-metric-card__values">
          <div class="cbp-metric-card__primary">
            <span class="cbp-metric-card__number cbp-animated-number" *ngIf="!loading">
              {{ animatedStats.countries.current | number }}
            </span>
            <app-skeleton-loader type="text" [lines]="1" *ngIf="loading"></app-skeleton-loader>
          </div>
          <div class="cbp-metric-card__secondary">
            <span *ngIf="!loading">of {{ stats.countries.total | number }} total</span>
            <app-skeleton-loader type="text" [lines]="1" *ngIf="loading"></app-skeleton-loader>
          </div>
        </div>
        <div class="cbp-metric-card__trend" *ngIf="!loading && stats.countries.trend !== 0">
          <div class="cbp-trend-indicator" [ngClass]="getTrendClass(stats.countries.trend)">
            <svg class="cbp-trend-icon" aria-hidden="true">
              <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getTrendIcon(stats.countries.trend)"></use>
            </svg>
            <span class="cbp-trend-text">{{ formatTrend(stats.countries.trend) }} weekly</span>
          </div>
        </div>
        <div class="cbp-metric-card__chart">
          <div class="cbp-progress-bar">
            <div class="cbp-progress-bar__fill" 
                 [style.width.%]="getActivePercentage('countries')"
                 [attr.data-percentage]="getActivePercentage('countries')">
            </div>
          </div>
          <div class="cbp-metric-card__percentage">
            {{ getActivePercentage('countries') }}% active
          </div>
        </div>
        <div class="cbp-mini-chart">
          <canvas #trendChart width="100" height="40"></canvas>
        </div>
      </div>
    </div>

    <!-- Ports Card -->
    <div class="cbp-metric-card cbp-slide-up" style="animation-delay: 0.2s" *ngIf="isCardEnabled('ports')">
      <div class="cbp-metric-card__icon cbp-metric-card__icon--ports">
        <svg class="cbp-metric-icon" aria-hidden="true">
          <use xlink:href="/assets/uswds/img/sprite.svg#place"></use>
        </svg>
      </div>
      <div class="cbp-metric-card__content">
        <div class="cbp-metric-card__header">
          <h3 class="cbp-metric-card__title">Ports</h3>
          <span class="cbp-badge cbp-badge--info">Operational</span>
        </div>
        <div class="cbp-metric-card__values">
          <div class="cbp-metric-card__primary">
            <span class="cbp-metric-card__number cbp-animated-number" *ngIf="!loading">
              {{ animatedStats.ports.current | number }}
            </span>
            <app-skeleton-loader type="text" [lines]="1" *ngIf="loading"></app-skeleton-loader>
          </div>
          <div class="cbp-metric-card__secondary">
            <span *ngIf="!loading">of {{ stats.ports.total | number }} total</span>
            <app-skeleton-loader type="text" [lines]="1" *ngIf="loading"></app-skeleton-loader>
          </div>
        </div>
        <div class="cbp-metric-card__trend" *ngIf="!loading && stats.ports.trend !== 0">
          <div class="cbp-trend-indicator" [ngClass]="getTrendClass(stats.ports.trend)">
            <svg class="cbp-trend-icon" aria-hidden="true">
              <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getTrendIcon(stats.ports.trend)"></use>
            </svg>
            <span class="cbp-trend-text">{{ formatTrend(stats.ports.trend) }} monthly</span>
          </div>
        </div>
        <div class="cbp-metric-card__chart">
          <div class="cbp-progress-bar">
            <div class="cbp-progress-bar__fill cbp-progress-bar__fill--info" 
                 [style.width.%]="getActivePercentage('ports')">
            </div>
          </div>
          <div class="cbp-metric-card__percentage">
            {{ getActivePercentage('ports') }}% active
          </div>
        </div>
      </div>
    </div>

    <!-- Airports Card -->
    <div class="cbp-metric-card cbp-slide-up" style="animation-delay: 0.3s" *ngIf="isCardEnabled('airports')">
      <div class="cbp-metric-card__icon cbp-metric-card__icon--airports">
        <svg class="cbp-metric-icon" aria-hidden="true">
          <use xlink:href="/assets/uswds/img/sprite.svg#flight_takeoff"></use>
        </svg>
      </div>
      <div class="cbp-metric-card__content">
        <div class="cbp-metric-card__header">
          <h3 class="cbp-metric-card__title">Airports</h3>
          <span class="cbp-badge cbp-badge--warning">Active</span>
        </div>
        <div class="cbp-metric-card__values">
          <div class="cbp-metric-card__primary">
            <span class="cbp-metric-card__number cbp-animated-number" *ngIf="!loading">
              {{ animatedStats.airports.current | number }}
            </span>
            <app-skeleton-loader type="text" [lines]="1" *ngIf="loading"></app-skeleton-loader>
          </div>
          <div class="cbp-metric-card__secondary">
            <span *ngIf="!loading">of {{ stats.airports.total | number }} total</span>
            <app-skeleton-loader type="text" [lines]="1" *ngIf="loading"></app-skeleton-loader>
          </div>
        </div>
        <div class="cbp-metric-card__trend" *ngIf="!loading && stats.airports.trend !== 0">
          <div class="cbp-trend-indicator" [ngClass]="getTrendClass(stats.airports.trend)">
            <svg class="cbp-trend-icon" aria-hidden="true">
              <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getTrendIcon(stats.airports.trend)"></use>
            </svg>
            <span class="cbp-trend-text">{{ formatTrend(stats.airports.trend) }} monthly</span>
          </div>
        </div>
        <div class="cbp-metric-card__chart">
          <div class="cbp-progress-bar">
            <div class="cbp-progress-bar__fill cbp-progress-bar__fill--warning" 
                 [style.width.%]="getActivePercentage('airports')">
            </div>
          </div>
          <div class="cbp-metric-card__percentage">
            {{ getActivePercentage('airports') }}% active
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Data Quality Score Widget -->
<div class="cbp-container cbp-section">
  <div class="cbp-card cbp-card--elevated cbp-scale-in cbp-interactive-card" 
       (click)="toggleQualityDetails()" 
       [class.cbp-card--active]="showQualityDetails">
    <div class="cbp-card__header">
      <div class="cbp-card__title-group">
        <h2 class="cbp-card__title">Data Quality Score</h2>
        <p class="cbp-card__subtitle">Overall health and quality metrics</p>
      </div>
      <div class="cbp-card__actions">
        <!-- Time Range Selector -->
        <div class="cbp-time-selector">
          <button 
            *ngFor="let range of ['day', 'week', 'month']" 
            class="cbp-time-button" 
            [class.active]="selectedTimeRange === range"
            (click)="onTimeRangeChange(range); $event.stopPropagation()">
            {{ range | titlecase }}
          </button>
        </div>
        <button class="cbp-expand-button" [class.expanded]="showQualityDetails">
          <svg class="cbp-icon" [style.transform]="showQualityDetails ? 'rotate(180deg)' : ''">
            <use xlink:href="/assets/uswds/img/sprite.svg#expand_more"></use>
          </svg>
        </button>
      </div>
    </div>
    <div class="cbp-card__body">
      <div class="cbp-quality-overview">
        <div class="cbp-quality-score">
          <div class="cbp-circular-progress" [attr.data-progress]="dataQuality.overall">
            <svg class="cbp-circular-progress__svg" viewBox="0 0 100 100">
              <circle 
                class="cbp-circular-progress__background" 
                cx="50" cy="50" r="45"
                fill="none" 
                stroke="#e5e7eb" 
                stroke-width="8">
              </circle>
              <circle 
                class="cbp-circular-progress__progress" 
                cx="50" cy="50" r="45"
                fill="none" 
                stroke="#10b981" 
                stroke-width="8"
                stroke-linecap="round"
                [style.stroke-dasharray]="2 * Math.PI * 45"
                [style.stroke-dashoffset]="2 * Math.PI * 45 * (1 - dataQuality.overall / 100)"
                transform="rotate(-90 50 50)">
              </circle>
            </svg>
            <div class="cbp-circular-progress__content">
              <span class="cbp-circular-progress__number">{{ dataQuality.overall }}%</span>
              <span class="cbp-circular-progress__label">Overall</span>
            </div>
          </div>
        </div>
        <div class="cbp-quality-breakdown">
          <div class="cbp-quality-metric" 
               (mouseenter)="onQualityMetricHover('completeness')" 
               (mouseleave)="onQualityMetricHover(null)"
               [class.cbp-quality-metric--hovered]="hoveredQualityMetric === 'completeness'"
               [title]="getQualityTooltip('completeness')">
            <div class="cbp-quality-metric__header">
              <span class="cbp-quality-metric__label">Completeness</span>
              <span class="cbp-quality-metric__score">{{ dataQuality.completeness }}%</span>
            </div>
            <div class="cbp-progress-bar cbp-progress-bar--small">
              <div class="cbp-progress-bar__fill cbp-progress-bar__fill--success" 
                   [style.width.%]="dataQuality.completeness"></div>
            </div>
          </div>
          <div class="cbp-quality-metric" 
               (mouseenter)="onQualityMetricHover('consistency')" 
               (mouseleave)="onQualityMetricHover(null)"
               [class.cbp-quality-metric--hovered]="hoveredQualityMetric === 'consistency'"
               [title]="getQualityTooltip('consistency')">
            <div class="cbp-quality-metric__header">
              <span class="cbp-quality-metric__label">Consistency</span>
              <span class="cbp-quality-metric__score">{{ dataQuality.consistency }}%</span>
            </div>
            <div class="cbp-progress-bar cbp-progress-bar--small">
              <div class="cbp-progress-bar__fill cbp-progress-bar__fill--info" 
                   [style.width.%]="dataQuality.consistency"></div>
            </div>
          </div>
          <div class="cbp-quality-metric" 
               (mouseenter)="onQualityMetricHover('validity')" 
               (mouseleave)="onQualityMetricHover(null)"
               [class.cbp-quality-metric--hovered]="hoveredQualityMetric === 'validity'"
               [title]="getQualityTooltip('validity')">
            <div class="cbp-quality-metric__header">
              <span class="cbp-quality-metric__label">Validity</span>
              <span class="cbp-quality-metric__score">{{ dataQuality.validity }}%</span>
            </div>
            <div class="cbp-progress-bar cbp-progress-bar--small">
              <div class="cbp-progress-bar__fill cbp-progress-bar__fill--warning" 
                   [style.width.%]="dataQuality.validity"></div>
            </div>
          </div>
          <div class="cbp-quality-metric" 
               (mouseenter)="onQualityMetricHover('uniqueness')" 
               (mouseleave)="onQualityMetricHover(null)"
               [class.cbp-quality-metric--hovered]="hoveredQualityMetric === 'uniqueness'"
               [title]="getQualityTooltip('uniqueness')">
            <div class="cbp-quality-metric__header">
              <span class="cbp-quality-metric__label">Uniqueness</span>
              <span class="cbp-quality-metric__score">{{ dataQuality.uniqueness }}%</span>
            </div>
            <div class="cbp-progress-bar cbp-progress-bar--small">
              <div class="cbp-progress-bar__fill" 
                   [style.width.%]="dataQuality.uniqueness"></div>
            </div>
          </div>
        </div>
        
        <!-- Quality Trends (shown when expanded) -->
        <div class="cbp-quality-trends" *ngIf="showQualityDetails">
          <h4 class="cbp-trends-title">Quality Trends ({{ selectedTimeRange | titlecase }})</h4>
          <div class="cbp-trends-chart">
            <canvas #qualityTrendsChart height="200"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced System Health Monitor -->
<div class="cbp-container cbp-section">
  <div class="cbp-card cbp-card--elevated cbp-scale-in cbp-interactive-card" 
       (click)="toggleHealthDetails()" 
       [class.cbp-card--active]="showHealthDetails">
    <div class="cbp-card__header">
      <div class="cbp-card__title-group">
        <h2 class="cbp-card__title">System Health</h2>
        <p class="cbp-card__subtitle">Infrastructure status and performance · Real-time updates</p>
      </div>
      <div class="cbp-card__actions">
        <div class="cbp-health-trend-indicator">
          <span class="cbp-trend-badge cbp-trend-badge--{{ getHealthTrend() }}">
            {{ getHealthTrend() | titlecase }}
          </span>
        </div>
        <button class="cbp-expand-button" [class.expanded]="showHealthDetails">
          <svg class="cbp-icon" [style.transform]="showHealthDetails ? 'rotate(180deg)' : ''">
            <use xlink:href="/assets/uswds/img/sprite.svg#expand_more"></use>
          </svg>
        </button>
      </div>
    </div>
    <div class="cbp-card__body">
      <div class="cbp-health-overview">
        <div class="cbp-health-summary">
          <div class="cbp-health-status" [ngClass]="getOverallHealthClass()">
            <div class="cbp-health-status__icon">
              <svg class="cbp-health-icon">
                <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getOverallHealthIcon()"></use>
              </svg>
            </div>
            <div class="cbp-health-status__content">
              <div class="cbp-health-status__label">System Status</div>
              <div class="cbp-health-status__value">{{ systemHealth.overall | titlecase }}</div>
            </div>
          </div>
          <div class="cbp-health-timestamp">
            Last checked: {{ getCurrentTime() | date:'short' }}
          </div>
        </div>
        
        <div class="cbp-health-components">
          <h3 class="cbp-health-components__title">Component Status</h3>
          <div class="cbp-health-grid">
            <div 
              *ngFor="let component of systemHealth.components" 
              class="cbp-health-component cbp-health-component--interactive"
              [attr.data-status]="component.status"
              [title]="component.name + ' - ' + (component.status | titlecase) + ' (' + formatResponseTime(component.responseTime!) + ')'"
            >
              <div class="cbp-health-component__status">
                <svg class="cbp-health-component__icon">
                  <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getHealthIcon(component.name)"></use>
                </svg>
                <div class="cbp-health-component__pulse" 
                     *ngIf="component.status === 'up'" 
                     class="cbp-pulse-animation"></div>
              </div>
              <div class="cbp-health-component__info">
                <div class="cbp-health-component__name">{{ component.name }}</div>
                <div class="cbp-health-component__status-text">
                  <span class="cbp-status-indicator" [attr.data-status]="component.status">
                    {{ component.status | uppercase }}
                  </span>
                  <span *ngIf="component.responseTime" class="cbp-health-component__response-time">
                    {{ formatResponseTime(component.responseTime) }}
                  </span>
                </div>
                <div class="cbp-health-component__last-checked">
                  Last checked: {{ component.lastChecked | date:'short' }}
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Health History Chart (shown when expanded) -->
        <div class="cbp-health-history" *ngIf="showHealthDetails">
          <h4 class="cbp-history-title">Health History (Last Hour)</h4>
          <div class="cbp-history-chart">
            <canvas #healthHistoryChart height="150"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Quick Actions Panel -->
<div class="cbp-container cbp-section">
  <div class="cbp-card cbp-card--elevated cbp-scale-in">
    <div class="cbp-card__header">
      <h2 class="cbp-card__title">Quick Actions</h2>
      <p class="cbp-card__subtitle">Common tasks and operations</p>
    </div>
    <div class="cbp-card__body">
      <!-- Sync Progress Indicators -->
      <div class="cbp-sync-progress" *ngIf="syncProgress.length > 0">
        <h4 class="cbp-progress-title">Active Sync Operations</h4>
        <div class="cbp-progress-list">
          <div *ngFor="let sync of syncProgress" class="cbp-sync-item" [attr.data-status]="sync.status">
            <div class="cbp-sync-info">
              <span class="cbp-sync-source">{{ sync.source }}</span>
              <span class="cbp-sync-description">{{ getSyncProgressDescription(sync) }}</span>
            </div>
            <div class="cbp-sync-progress-bar" *ngIf="sync.status === 'running'">
              <div class="cbp-progress-bar cbp-progress-bar--small">
                <div class="cbp-progress-bar__fill" [style.width.%]="sync.progress"></div>
              </div>
            </div>
            <div class="cbp-sync-status" [class]="'cbp-status--' + sync.status">
              <svg class="cbp-status-icon">
                <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + (sync.status === 'completed' ? 'check_circle' : sync.status === 'failed' ? 'error' : 'sync')"></use>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Export Queue -->
      <div class="cbp-export-queue" *ngIf="exportRequests.length > 0">
        <h4 class="cbp-queue-title">Export Queue</h4>
        <div class="cbp-export-list">
          <div *ngFor="let export of exportRequests" class="cbp-export-item" [attr.data-status]="export.status">
            <div class="cbp-export-info">
              <span class="cbp-export-dataset">{{ export.dataset | titlecase }}.{{ export.format.toUpperCase() }}</span>
              <span class="cbp-export-status">{{ export.status | titlecase }}</span>
            </div>
            <button 
              class="cbp-download-button" 
              *ngIf="export.status === 'ready'" 
              (click)="downloadExport(export)">
              <svg class="cbp-button__icon">
                <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getExportStatusIcon(export.status)"></use>
              </svg>
              Download
            </button>
            <div class="cbp-export-status-icon" *ngIf="export.status !== 'ready'">
              <svg class="cbp-status-icon" [class.cbp-spinning]="export.status === 'processing'">
                <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getExportStatusIcon(export.status)"></use>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <div class="cbp-actions-grid">
        <div 
          *ngFor="let action of quickActions" 
          class="cbp-action-card cbp-action-card--enhanced"
          [ngClass]="getActionPriorityClass(action.priority)"
          (click)="executeQuickAction(action.id)"
        >
          <div class="cbp-action-card__icon">
            <svg class="cbp-action-icon">
              <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + action.icon"></use>
            </svg>
          </div>
          <div class="cbp-action-card__content">
            <h4 class="cbp-action-card__title">{{ action.title }}</h4>
            <p class="cbp-action-card__description">{{ action.description }}</p>
            <div class="cbp-action-card__count" *ngIf="action.count !== undefined">
              <span class="cbp-badge cbp-badge--small cbp-badge--warning">{{ action.count }} pending</span>
            </div>
            <!-- Keyboard shortcut hint -->
            <div class="cbp-action-shortcut" *ngIf="action.id === 'add-new-entry'">
              <kbd>Ctrl</kbd> + <kbd>K</kbd>
            </div>
            <div class="cbp-action-shortcut" *ngIf="action.id === 'export-dataset'">
              <kbd>Ctrl</kbd> + <kbd>E</kbd>
            </div>
          </div>
          <div class="cbp-action-card__button">
            <button class="cbp-button cbp-button--primary cbp-button--round" type="button">
              <svg class="cbp-button__icon">
                <use xlink:href="/assets/uswds/img/sprite.svg#arrow_forward"></use>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Enhanced Recent Activity Timeline -->
<div class="cbp-container cbp-section">
  <div class="cbp-card cbp-card--elevated cbp-scale-in">
    <div class="cbp-card__header">
      <div class="cbp-card__title-group">
        <h2 class="cbp-card__title">Recent Activity</h2>
        <p class="cbp-card__subtitle">Latest changes and system events</p>
      </div>
      <div class="cbp-card__actions">
        <!-- Activity Filter Buttons -->
        <div class="cbp-activity-filters">
          <button 
            *ngFor="let filterType of ['ALL', 'CREATE', 'UPDATE', 'DELETE']" 
            class="cbp-filter-button" 
            [class.active]="activityFilter.type === filterType"
            (click)="filterActivity({ type: filterType })">
            {{ filterType }}
            <span class="cbp-filter-count">{{ getActivityFilterCount(filterType) }}</span>
          </button>
        </div>
      </div>
    </div>
    <div class="cbp-card__body">
      <div *ngIf="loading">
        <app-skeleton-loader type="activity" [activityItems]="5"></app-skeleton-loader>
      </div>
      
      <div *ngIf="!loading && recentActivity.length === 0" class="cbp-activity-empty">
        <div class="cbp-activity-empty__icon">
          <svg class="cbp-empty-icon">
            <use xlink:href="/assets/uswds/img/sprite.svg#history"></use>
          </svg>
        </div>
        <div class="cbp-activity-empty__text">No recent activity</div>
        <div class="cbp-activity-empty__subtitle">Changes will appear here as they occur</div>
      </div>
      
      <div *ngIf="!loading && filteredActivity.length > 0" class="cbp-activity-timeline">
        <div 
          *ngFor="let activity of filteredActivity; let i = index" 
          class="cbp-activity-item cbp-activity-item--interactive"
          [style.animation-delay]="(i * 0.1) + 's'"
          (click)="viewActivityDetails(activity)"
        >
          <div class="cbp-activity-item__indicator">
            <!-- Enhanced User Avatar -->
            <div class="cbp-activity-item__avatar" 
                 [style.background-color]="getUserAvatarColor(activity.user)"
                 [title]="activity.user">
              <span class="cbp-avatar-initials">{{ getUserInitials(activity.user) }}</span>
            </div>
            <div class="cbp-activity-item__dot" [attr.data-type]="activity.type.toLowerCase()">
              <svg class="cbp-activity-item__icon">
                <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getActivityIcon(activity.type)"></use>
              </svg>
            </div>
            <div class="cbp-activity-item__line" *ngIf="i < filteredActivity.length - 1"></div>
          </div>
          <div class="cbp-activity-item__content">
            <div class="cbp-activity-item__header">
              <div class="cbp-activity-item__user-info">
                <span class="cbp-activity-item__user-name">{{ activity.user.split('@')[0] | titlecase }}</span>
                <span class="cbp-badge cbp-badge--small" [ngClass]="{
                  'cbp-badge--success': activity.type === 'CREATE',
                  'cbp-badge--info': activity.type === 'UPDATE',
                  'cbp-badge--warning': activity.type === 'DELETE'
                }">
                  {{ activity.type }}
                </span>
                <span class="cbp-activity-item__entity">{{ activity.entityType }}</span>
                <!-- Priority Indicator -->
                <span class="cbp-priority-indicator" 
                      *ngIf="activity.priority === 'high'" 
                      class="cbp-priority--high" 
                      title="High Priority">
                  <svg class="cbp-priority-icon">
                    <use xlink:href="/assets/uswds/img/sprite.svg#priority_high"></use>
                  </svg>
                </span>
              </div>
              <div class="cbp-activity-item__time-group">
                <span class="cbp-activity-item__time">{{ formatDate(activity.timestamp) }}</span>
                <button class="cbp-activity-details-button" title="View Details">
                  <svg class="cbp-icon">
                    <use xlink:href="/assets/uswds/img/sprite.svg#info"></use>
                  </svg>
                </button>
              </div>
            </div>
            <div class="cbp-activity-item__body">
              <p class="cbp-activity-item__description">{{ activity.description }}</p>
              <div class="cbp-activity-item__meta">
                <div class="cbp-activity-item__user">
                  <svg class="cbp-user-icon">
                    <use xlink:href="/assets/uswds/img/sprite.svg#email"></use>
                  </svg>
                  <span>{{ activity.user }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Load More Button -->
        <div class="cbp-activity-load-more" *ngIf="activityTotal > filteredActivity.length">
          <button 
            class="cbp-button cbp-button--secondary cbp-button--wide" 
            (click)="loadMoreActivity()" 
            [disabled]="activityLoadingMore">
            <svg class="cbp-button__icon" [class.cbp-spinning]="activityLoadingMore">
              <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + (activityLoadingMore ? 'refresh' : 'expand_more')"></use>
            </svg>
            {{ activityLoadingMore ? 'Loading...' : 'Load More Activity' }}
          </button>
        </div>
      </div>
    </div>
    <div class="cbp-card__footer" *ngIf="filteredActivity.length > 0">
      <div class="cbp-activity-summary">
        <span class="cbp-activity-count">Showing {{ filteredActivity.length }} of {{ activityTotal }} activities</span>
      </div>
      <a routerLink="/activity-log" class="cbp-button cbp-button--secondary">
        View All Activity
        <svg class="cbp-button__icon cbp-button__icon--right">
          <use xlink:href="/assets/uswds/img/sprite.svg#arrow_forward"></use>
        </svg>
      </a>
    </div>
  </div>
</div>

<!-- Charts and Visualizations Section -->
<div class="cbp-container cbp-section">
  <div class="cbp-charts-grid">
    <!-- API Usage Chart -->
    <div class="cbp-chart-card cbp-scale-in">
      <div class="cbp-chart-card__header">
        <h3 class="cbp-chart-card__title">API Usage</h3>
        <p class="cbp-chart-card__subtitle">Requests per hour (last 24 hours)</p>
      </div>
      <div class="cbp-chart-card__body">
        <div class="cbp-chart-container">
          <canvas #apiUsageChart></canvas>
        </div>
      </div>
    </div>

    <!-- Data Growth Chart -->
    <div class="cbp-chart-card cbp-scale-in">
      <div class="cbp-chart-card__header">
        <h3 class="cbp-chart-card__title">Data Growth Timeline</h3>
        <p class="cbp-chart-card__subtitle">Monthly growth across datasets</p>
      </div>
      <div class="cbp-chart-card__body">
        <div class="cbp-chart-container">
          <canvas #dataGrowthChart></canvas>
        </div>
      </div>
    </div>

    <!-- Change Request Status Chart -->
    <div class="cbp-chart-card cbp-scale-in">
      <div class="cbp-chart-card__header">
        <h3 class="cbp-chart-card__title">Change Request Status</h3>
        <p class="cbp-chart-card__subtitle">Current workflow distribution</p>
      </div>
      <div class="cbp-chart-card__body">
        <div class="cbp-chart-container">
          <canvas #changeRequestChart></canvas>
        </div>
      </div>
    </div>

    <!-- Activity Heatmap Chart -->
    <div class="cbp-chart-card cbp-scale-in">
      <div class="cbp-chart-card__header">
        <h3 class="cbp-chart-card__title">Activity Heatmap</h3>
        <p class="cbp-chart-card__subtitle">User activity patterns by time</p>
      </div>
      <div class="cbp-chart-card__body">
        <div class="cbp-chart-container">
          <canvas #activityHeatmapChart></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Quick Add Modal -->
<div class="usa-modal" [class.is-visible]="showQuickAddModal" *ngIf="showQuickAddModal" (click)="closeQuickAddModal()">
  <div class="usa-modal__content" (click)="$event.stopPropagation()">
    <div class="usa-modal__header">
      <h2 class="usa-modal__heading">Add Reference Data</h2>
      <button 
        class="usa-modal__close" 
        (click)="closeQuickAddModal()"
        aria-label="Close modal"
      >
        <svg class="usa-icon" aria-hidden="true" focusable="false" role="img">
          <use xlink:href="/assets/uswds/img/sprite.svg#close"></use>
        </svg>
      </button>
    </div>
    
    <div class="usa-modal__main">
      <!-- Entity Type Selection -->
      <div class="cbp-form-section">
        <label class="usa-label" for="add-type">What would you like to add?</label>
        <select 
          class="usa-select" 
          id="add-type" 
          [(ngModel)]="quickAddType"
          (change)="onQuickAddTypeChange()"
        >
          <option value="country">Country</option>
          <option value="port">Port</option>
          <option value="airport">Airport</option>
        </select>
      </div>

      <!-- Code System Selection -->
      <div class="cbp-code-system-section" *ngIf="quickAddType === 'country'">
        <label class="usa-label" for="code-system">
          Code System <abbr title="required" class="usa-hint usa-hint--required">*</abbr>
        </label>
        <select 
          class="usa-select" 
          id="code-system" 
          [(ngModel)]="quickAddData.codeSystem"
          (change)="onCodeSystemChange()"
        >
          <option value="ISO3166-1">ISO 3166-1 (International Standard)</option>
          <option value="GENC">GENC (Geopolitical Entities, Names and Codes)</option>
          <option value="US-Census">US Census Bureau</option>
          <option value="CBP-Country">CBP Country Codes</option>
        </select>
        <div class="usa-hint" style="margin-top: 0.5rem;">
          {{ getCodeSystemDescription(quickAddData.codeSystem) }}
        </div>
      </div>

      <!-- Country Form -->
      <div *ngIf="quickAddType === 'country'" class="cbp-form-section">
        <div class="grid-row grid-gap">
          <div class="grid-col-12">
            <label class="usa-label" for="quick-country-name">
              Country Name <abbr title="required" class="usa-hint usa-hint--required">*</abbr>
            </label>
            <input 
              class="usa-input" 
              id="quick-country-name" 
              type="text" 
              [(ngModel)]="quickAddData.countryName"
              placeholder="Enter official country name"
              required
            />
          </div>

          <div class="grid-col-12 tablet:grid-col-6">
            <label class="usa-label" for="quick-country-code">
              Primary Code <abbr title="required" class="usa-hint usa-hint--required">*</abbr>
            </label>
            <input 
              class="usa-input" 
              id="quick-country-code" 
              type="text" 
              [(ngModel)]="quickAddData.countryCode"
              [placeholder]="getCodePlaceholder(quickAddData.codeSystem)"
              [maxlength]="getCodeMaxLength(quickAddData.codeSystem)"
              style="text-transform: uppercase;"
              required
            />
          </div>

          <div class="grid-col-12 tablet:grid-col-6">
            <label class="usa-label" for="quick-numeric">Numeric Code</label>
            <input 
              class="usa-input" 
              id="quick-numeric" 
              type="text" 
              maxlength="3"
              [(ngModel)]="quickAddData.numericCode"
              placeholder="000"
              pattern="[0-9]{3}"
            />
          </div>

          <!-- ISO Codes Section (when applicable) -->
          <div *ngIf="shouldShowIsoCodes()" class="grid-col-12">
            <fieldset class="usa-fieldset">
              <legend class="usa-legend">ISO 3166-1 Codes</legend>
              <div class="grid-row grid-gap">
                <div class="grid-col-12 tablet:grid-col-6">
                  <label class="usa-label" for="quick-iso2">Alpha-2 Code</label>
                  <input 
                    class="usa-input" 
                    id="quick-iso2" 
                    type="text" 
                    maxlength="2"
                    [(ngModel)]="quickAddData.iso2Code"
                    placeholder="US"
                    style="text-transform: uppercase;"
                  />
                </div>
                <div class="grid-col-12 tablet:grid-col-6">
                  <label class="usa-label" for="quick-iso3">Alpha-3 Code</label>
                  <input 
                    class="usa-input" 
                    id="quick-iso3" 
                    type="text" 
                    maxlength="3"
                    [(ngModel)]="quickAddData.iso3Code"
                    placeholder="USA"
                    style="text-transform: uppercase;"
                  />
                </div>
              </div>
            </fieldset>
          </div>

          <!-- GENC Codes Section (when applicable) -->
          <div *ngIf="quickAddData.codeSystem === 'GENC'" class="grid-col-12">
            <fieldset class="usa-fieldset">
              <legend class="usa-legend">GENC Codes</legend>
              <div class="grid-row grid-gap">
                <div class="grid-col-12 tablet:grid-col-6">
                  <label class="usa-label" for="quick-genc2">GENC 2-Letter</label>
                  <input 
                    class="usa-input" 
                    id="quick-genc2" 
                    type="text" 
                    maxlength="2"
                    [(ngModel)]="quickAddData.genc2Code"
                    placeholder="US"
                    style="text-transform: uppercase;"
                  />
                </div>
                <div class="grid-col-12 tablet:grid-col-6">
                  <label class="usa-label" for="quick-genc3">GENC 3-Letter</label>
                  <input 
                    class="usa-input" 
                    id="quick-genc3" 
                    type="text" 
                    maxlength="3"
                    [(ngModel)]="quickAddData.genc3Code"
                    placeholder="USA"
                    style="text-transform: uppercase;"
                  />
                </div>
              </div>
            </fieldset>
          </div>

          <div class="grid-col-12">
            <fieldset class="usa-fieldset">
              <legend class="usa-legend">Status</legend>
              <div class="usa-radio">
                <input 
                  class="usa-radio__input" 
                  id="quick-active" 
                  type="radio" 
                  [value]="true"
                  [(ngModel)]="quickAddData.isActive"
                  name="quickActive"
                />
                <label class="usa-radio__label" for="quick-active">Active</label>
              </div>
              <div class="usa-radio">
                <input 
                  class="usa-radio__input" 
                  id="quick-inactive" 
                  type="radio" 
                  [value]="false"
                  [(ngModel)]="quickAddData.isActive"
                  name="quickActive"
                />
                <label class="usa-radio__label" for="quick-inactive">Inactive</label>
              </div>
            </fieldset>
          </div>
        </div>
      </div>

      <!-- Port Form -->
      <div *ngIf="quickAddType === 'port'" class="cbp-form-section">
        <div class="grid-row grid-gap">
          <div class="grid-col-12">
            <label class="usa-label" for="quick-port-name">
              Port Name <abbr title="required" class="usa-hint usa-hint--required">*</abbr>
            </label>
            <input 
              class="usa-input" 
              id="quick-port-name" 
              type="text" 
              [(ngModel)]="quickAddData.portName"
              placeholder="Enter port name"
              required
            />
          </div>
          <div class="grid-col-12 tablet:grid-col-6">
            <label class="usa-label" for="quick-port-code">
              Port Code <abbr title="required" class="usa-hint usa-hint--required">*</abbr>
            </label>
            <input 
              class="usa-input" 
              id="quick-port-code" 
              type="text" 
              [(ngModel)]="quickAddData.portCode"
              placeholder="Enter port code"
              maxlength="5"
              style="text-transform: uppercase;"
              required
            />
          </div>
          <div class="grid-col-12 tablet:grid-col-6">
            <label class="usa-label" for="quick-port-country">Country</label>
            <input 
              class="usa-input" 
              id="quick-port-country" 
              type="text" 
              [(ngModel)]="quickAddData.country"
              placeholder="Enter country"
            />
          </div>
        </div>
      </div>

      <!-- Airport Form -->
      <div *ngIf="quickAddType === 'airport'" class="cbp-form-section">
        <div class="grid-row grid-gap">
          <div class="grid-col-12">
            <label class="usa-label" for="quick-airport-name">
              Airport Name <abbr title="required" class="usa-hint usa-hint--required">*</abbr>
            </label>
            <input 
              class="usa-input" 
              id="quick-airport-name" 
              type="text" 
              [(ngModel)]="quickAddData.airportName"
              placeholder="Enter airport name"
              required
            />
          </div>
          <div class="grid-col-12 tablet:grid-col-4">
            <label class="usa-label" for="quick-iata-code">
              IATA Code <abbr title="required" class="usa-hint usa-hint--required">*</abbr>
            </label>
            <input 
              class="usa-input" 
              id="quick-iata-code" 
              type="text" 
              [(ngModel)]="quickAddData.iataCode"
              placeholder="LAX"
              maxlength="3"
              style="text-transform: uppercase;"
              required
            />
          </div>
          <div class="grid-col-12 tablet:grid-col-4">
            <label class="usa-label" for="quick-icao-code">ICAO Code</label>
            <input 
              class="usa-input" 
              id="quick-icao-code" 
              type="text" 
              [(ngModel)]="quickAddData.icaoCode"
              placeholder="KLAX"
              maxlength="4"
              style="text-transform: uppercase;"
            />
          </div>
          <div class="grid-col-12 tablet:grid-col-4">
            <label class="usa-label" for="quick-airport-country">Country</label>
            <input 
              class="usa-input" 
              id="quick-airport-country" 
              type="text" 
              [(ngModel)]="quickAddData.country"
              placeholder="Enter country"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="usa-modal__footer">
      <ul class="usa-button-group">
        <li class="usa-button-group__item">
          <button 
            type="button" 
            class="usa-button" 
            (click)="submitQuickAdd()"
            [disabled]="!isFormValid()"
          >
            <svg class="cbp-button__icon" aria-hidden="true">
              <use xlink:href="/assets/uswds/img/sprite.svg#add"></use>
            </svg>
            Create {{ quickAddType | titlecase }}
          </button>
        </li>
        <li class="usa-button-group__item">
          <button 
            type="button" 
            class="usa-button usa-button--outline" 
            (click)="closeQuickAddModal()"
          >
            Cancel
          </button>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Change Request Modal -->
<div class="usa-modal" [class.is-visible]="showChangeRequestModal" *ngIf="showChangeRequestModal" (click)="closeChangeRequestModal()">
  <div class="usa-modal__content" (click)="$event.stopPropagation()">
    <div class="usa-modal__header">
      <h2 class="usa-modal__heading">Create Change Request</h2>
      <button 
        class="usa-modal__close" 
        (click)="closeChangeRequestModal()"
        aria-label="Close modal"
      >
        <svg class="usa-icon" aria-hidden="true" focusable="false" role="img">
          <use xlink:href="/assets/uswds/img/sprite.svg#close"></use>
        </svg>
      </button>
    </div>
    
    <div class="usa-modal__main">
      <!-- Entity Type Selection -->
      <div class="cbp-form-section">
        <label class="usa-label" for="cr-entity-type">Entity Type</label>
        <select 
          class="usa-select" 
          id="cr-entity-type" 
          [(ngModel)]="changeRequestData.entityType"
        >
          <option value="country">Country</option>
          <option value="port">Port</option>
          <option value="airport">Airport</option>
          <option value="carrier">Carrier</option>
        </select>
      </div>

      <!-- Change Type Selection -->
      <div class="cbp-form-section">
        <label class="usa-label" for="cr-change-type">Change Type</label>
        <select 
          class="usa-select" 
          id="cr-change-type" 
          [(ngModel)]="changeRequestData.changeType"
        >
          <option value="CREATE">Create New</option>
          <option value="UPDATE">Update Existing</option>
          <option value="DELETE">Delete</option>
        </select>
      </div>

      <!-- Entity ID (for updates/deletes) -->
      <div class="cbp-form-section" *ngIf="changeRequestData.changeType !== 'CREATE'">
        <label class="usa-label" for="cr-entity-id">Entity ID</label>
        <input 
          class="usa-input" 
          id="cr-entity-id" 
          type="text" 
          [(ngModel)]="changeRequestData.entityId"
          placeholder="Enter the ID of the entity to modify"
        />
        <span class="usa-hint">Provide the unique identifier of the existing record</span>
      </div>

      <!-- Description -->
      <div class="cbp-form-section">
        <label class="usa-label" for="cr-description">Description *</label>
        <textarea 
          class="usa-textarea" 
          id="cr-description" 
          [(ngModel)]="changeRequestData.description"
          rows="3"
          placeholder="Describe the changes being requested"
        ></textarea>
        <span class="usa-hint">Provide a clear description of what needs to be changed</span>
      </div>

      <!-- Business Justification -->
      <div class="cbp-form-section">
        <label class="usa-label" for="cr-justification">Business Justification *</label>
        <textarea 
          class="usa-textarea" 
          id="cr-justification" 
          [(ngModel)]="changeRequestData.justification"
          rows="3"
          placeholder="Explain why this change is needed"
        ></textarea>
        <span class="usa-hint">Provide the business reason for this change request</span>
      </div>

      <!-- Priority -->
      <div class="cbp-form-section">
        <label class="usa-label" for="cr-priority">Priority</label>
        <select 
          class="usa-select" 
          id="cr-priority" 
          [(ngModel)]="changeRequestData.priority"
        >
          <option value="LOW">Low</option>
          <option value="MEDIUM" selected>Medium</option>
          <option value="HIGH">High</option>
          <option value="CRITICAL">Critical</option>
        </select>
      </div>

      <!-- Effective Date -->
      <div class="cbp-form-section">
        <label class="usa-label" for="cr-effective-date">Effective Date</label>
        <input 
          class="usa-input" 
          id="cr-effective-date" 
          type="date" 
          [(ngModel)]="changeRequestData.effectiveDate"
        />
        <span class="usa-hint">When should this change take effect?</span>
      </div>
    </div>

    <div class="usa-modal__footer">
      <ul class="usa-button-group">
        <li class="usa-button-group__item">
          <button 
            type="button" 
            class="usa-button" 
            (click)="submitChangeRequest()"
            [disabled]="!isChangeRequestFormValid()"
          >
            <svg class="cbp-button__icon" aria-hidden="true">
              <use xlink:href="/assets/uswds/img/sprite.svg#check"></use>
            </svg>
            Submit Request
          </button>
        </li>
        <li class="usa-button-group__item">
          <button 
            type="button" 
            class="usa-button usa-button--secondary" 
            (click)="closeChangeRequestModal()"
          >
            Cancel
          </button>
        </li>
      </ul>
    </div>
  </div>
</div>

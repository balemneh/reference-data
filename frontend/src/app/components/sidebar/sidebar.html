<!-- Sidebar Navigation -->
<nav 
  class="cbp-sidebar"
  [class.cbp-sidebar--collapsed]="isCollapsed"
  [attr.aria-label]="'Primary navigation'"
  role="navigation"
>
  <!-- Sidebar Header with Toggle -->
  <div class="cbp-sidebar__header">
    <button 
      class="cbp-sidebar__toggle"
      (click)="onToggleSidebar()"
      [attr.aria-label]="isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'"
      [attr.aria-expanded]="!isCollapsed"
    >
      <svg class="cbp-sidebar__toggle-icon" aria-hidden="true" role="img">
        <use xlink:href="/assets/uswds/img/sprite.svg#menu"></use>
      </svg>
    </button>
    <span class="cbp-sidebar__title" *ngIf="!isCollapsed">Navigation</span>
  </div>

  <!-- Sidebar Content -->
  <div class="cbp-sidebar__content">
    <ul class="cbp-sidebar__list" role="menubar">
      
      <!-- Iterate through navigation items -->
      <ng-container *ngFor="let item of navigationItems">
        <li
          class="cbp-sidebar__item"
          *ngIf="item.type === 'navigation' ? isItemVisible(item) : isCategoryVisible(item)"
          [class.cbp-sidebar__item--active]="item.type === 'navigation' && isItemActive(item)"
          [class.cbp-sidebar__item--category-active]="item.type === 'category' && isCategoryActive(item)"
          role="none"
        >
        
        <!-- Regular navigation item -->
        <ng-container *ngIf="item.type === 'navigation'">
          <a 
            class="cbp-sidebar__link"
            [routerLink]="item.path!"
            routerLinkActive="cbp-sidebar__link--active"
            [routerLinkActiveOptions]="{exact: item.path === '/dashboard'}"
            [attr.title]="item.label"
            [attr.aria-label]="item.label + (item.badge ? ' (' + item.badge + ' pending)' : '')"
            role="menuitem"
            (click)="onItemClick(item)"
          >
            <div class="cbp-sidebar__link-content">
              <svg class="cbp-sidebar__icon" aria-hidden="true" role="img">
                <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + item.icon"></use>
              </svg>
              <span class="cbp-sidebar__text" *ngIf="!isCollapsed">{{ item.label }}</span>
              <span 
                class="cbp-sidebar__badge" 
                *ngIf="item.badge && item.badge > 0 && !isCollapsed"
                [attr.aria-label]="item.badge + ' pending'"
              >
                {{ item.badge }}
              </span>
            </div>
          </a>
        </ng-container>
        
        <!-- Category with expandable children -->
        <ng-container *ngIf="item.type === 'category'">
          <button
            class="cbp-sidebar__category"
            [class.cbp-sidebar__category--expanded]="isCategoryExpanded(item.id)"
            [class.cbp-sidebar__category--active]="isCategoryActive(item)"
            [attr.aria-expanded]="isCategoryExpanded(item.id)"
            [attr.aria-label]="item.label + ' category'"
            role="menuitem"
            [attr.aria-haspopup]="'menu'"
            (click)="onItemClick(item)"
          >
            <div class="cbp-sidebar__category-content">
              <svg class="cbp-sidebar__icon" aria-hidden="true" role="img">
                <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + item.icon"></use>
              </svg>
              <span class="cbp-sidebar__text" *ngIf="!isCollapsed">{{ item.label }}</span>
              <svg 
                class="cbp-sidebar__expand-icon" 
                *ngIf="!isCollapsed"
                aria-hidden="true" 
                role="img"
                [class.cbp-sidebar__expand-icon--rotated]="isCategoryExpanded(item.id)"
              >
                <use xlink:href="/assets/uswds/img/sprite.svg#expand_more"></use>
              </svg>
            </div>
          </button>
          
          <!-- Category children (collapsible) -->
          <ul 
            class="cbp-sidebar__submenu"
            [class.cbp-sidebar__submenu--expanded]="isCategoryExpanded(item.id) && !isCollapsed"
            role="menu"
            [attr.aria-label]="item.label + ' submenu'"
            *ngIf="item.children && !isCollapsed"
          >
            <li
              class="cbp-sidebar__subitem"
              *ngFor="let child of getVisibleChildren(item)"
              [class.cbp-sidebar__subitem--active]="isItemActive(child)"
              role="none"
            >
              <a 
                class="cbp-sidebar__sublink"
                [routerLink]="child.path!"
                routerLinkActive="cbp-sidebar__sublink--active"
                [routerLinkActiveOptions]="{exact: false}"
                [attr.title]="child.label"
                [attr.aria-label]="child.label + (child.badge ? ' (' + child.badge + ' pending)' : '')"
                role="menuitem"
                (click)="onItemClick(child)"
              >
                <div class="cbp-sidebar__sublink-content">
                  <svg class="cbp-sidebar__subicon" aria-hidden="true" role="img">
                    <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + child.icon"></use>
                  </svg>
                  <span class="cbp-sidebar__subtext">{{ child.label }}</span>
                  <span 
                    class="cbp-sidebar__badge cbp-sidebar__badge--sub" 
                    *ngIf="child.badge && child.badge > 0"
                    [attr.aria-label]="child.badge + ' pending'"
                  >
                    {{ child.badge }}
                  </span>
                </div>
              </a>
            </li>
          </ul>
        </ng-container>
      </li>
    </ng-container>
    </ul>
  </div>
</nav>
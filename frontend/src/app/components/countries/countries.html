<div class="grid-container">
  <!-- Enhanced Header Section -->
  <div class="cbp-page-header cbp-fade-in">
    <div class="cbp-page-header__content">
      <div class="cbp-page-header__text">
        <h1 class="cbp-page-header__title cbp-text-gradient">Countries Management</h1>
        <p class="cbp-page-header__subtitle">Centralized management for country reference data across multiple code systems</p>
      </div>
      <div class="cbp-page-header__actions">
        <button class="cbp-button cbp-button--secondary" (click)="exportSelected()" [disabled]="!hasSelectedItems">
          <svg class="cbp-button__icon" aria-hidden="true">
            <use xlink:href="/assets/uswds/img/sprite.svg#file_download"></use>
          </svg>
          Export Data
        </button>
        <button class="cbp-button cbp-button--primary" (click)="addCountry()">
          <svg class="cbp-button__icon" aria-hidden="true">
            <use xlink:href="/assets/uswds/img/sprite.svg#add"></use>
          </svg>
          Add Country
        </button>
      </div>
    </div>
  </div>

  <!-- Enhanced Alert Messages -->
  <div *ngIf="successMessage" class="cbp-alert cbp-alert--success cbp-slide-up margin-bottom-3" role="alert">
    <div class="cbp-alert__content">
      <svg class="cbp-alert__icon" aria-hidden="true">
        <use xlink:href="/assets/uswds/img/sprite.svg#check_circle"></use>
      </svg>
      <div class="cbp-alert__body">
        <h4 class="cbp-alert__title">Success</h4>
        <p class="cbp-alert__text">{{ successMessage }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="error" class="cbp-alert cbp-alert--error cbp-slide-up margin-bottom-3" role="alert">
    <div class="cbp-alert__content">
      <svg class="cbp-alert__icon" aria-hidden="true">
        <use xlink:href="/assets/uswds/img/sprite.svg#error"></use>
      </svg>
      <div class="cbp-alert__body">
        <h4 class="cbp-alert__title">Error</h4>
        <p class="cbp-alert__text">{{ error }}</p>
      </div>
    </div>
  </div>

  <!-- Enhanced Filters and Actions Bar -->
  <div class="cbp-filters-container cbp-slide-up">
    <div class="cbp-filters-card">
      <div class="cbp-filters-header">
        <div class="cbp-filters-title">
          <svg class="cbp-filters-icon" aria-hidden="true">
            <use xlink:href="/assets/uswds/img/sprite.svg#filter_list"></use>
          </svg>
          <h3>Filter & Search</h3>
        </div>
        <div class="cbp-filters-count" *ngIf="countries.length > 0">
          <span class="cbp-count-badge">{{ countries.length }}</span> results
        </div>
      </div>
      
      <div class="cbp-filters-content">
        <!-- Combined Search and Filters Row -->
        <div class="cbp-filters-row">
          <!-- Enhanced Search -->
          <div class="cbp-search-field">
            <label class="cbp-field-label" for="search-countries">
              <svg class="cbp-label-icon" aria-hidden="true">
                <use xlink:href="/assets/uswds/img/sprite.svg#search"></use>
              </svg>
              Search Countries
            </label>
            <div class="cbp-search-input">
              <input
                #searchInput
                class="cbp-input cbp-input--search"
                id="search-countries"
                type="search"
                placeholder="Search by country name, code, or ISO..."
                (input)="onSearchInput($event)"
                [value]="searchTerm"
              />
              <button 
                class="cbp-search-clear" 
                type="button" 
                *ngIf="searchTerm" 
                (click)="clearSearch()"
                aria-label="Clear search"
              >
                <svg class="cbp-search-clear-icon" aria-hidden="true">
                  <use xlink:href="/assets/uswds/img/sprite.svg#close"></use>
                </svg>
              </button>
            </div>
          </div>

          <!-- Enhanced Code System Filter -->
          <div class="cbp-filter-field">
            <label class="cbp-field-label" for="code-system">
              <svg class="cbp-label-icon" aria-hidden="true">
                <use xlink:href="/assets/uswds/img/sprite.svg#code"></use>
              </svg>
              Code System
            </label>
            <select 
              class="cbp-select" 
              id="code-system" 
              [(ngModel)]="codeSystem" 
              (change)="onCodeSystemChange()"
            >
              <option *ngFor="let system of availableCodeSystems" [value]="system">{{ system }}</option>
            </select>
          </div>

          <!-- Enhanced Status Filter -->
          <div class="cbp-filter-field">
            <label class="cbp-field-label" for="active-filter">
              <svg class="cbp-label-icon" aria-hidden="true">
                <use xlink:href="/assets/uswds/img/sprite.svg#toggle_on"></use>
              </svg>
              Status
            </label>
            <select 
              class="cbp-select" 
              id="active-filter" 
              (change)="onActiveFilterChange($any($event.target).value)"
            >
              <option value="all">All Status</option>
              <option value="active">Active Only</option>
              <option value="inactive">Inactive Only</option>
            </select>
          </div>

          <!-- Quick Actions -->
          <div class="cbp-filter-actions">
            <button 
              class="cbp-button cbp-button--outline cbp-button--small" 
              (click)="resetFilters()"
              *ngIf="hasActiveFilters"
            >
              <svg class="cbp-button__icon" aria-hidden="true">
                <use xlink:href="/assets/uswds/img/sprite.svg#clear"></use>
              </svg>
              Clear Filters
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Enhanced Data Table -->
  <div class="cbp-table-container cbp-scale-in">
    <div class="cbp-table-header">
      <div class="cbp-table-header__left">
        <div class="cbp-bulk-actions" *ngIf="selectedItems.length > 0">
          <span class="cbp-selected-count">
            <svg class="cbp-selected-icon" aria-hidden="true">
              <use xlink:href="/assets/uswds/img/sprite.svg#check_circle"></use>
            </svg>
            {{ selectedItems.length }} selected
          </span>
          <div class="cbp-bulk-buttons">
            <button class="cbp-button cbp-button--outline cbp-button--small">
              <svg class="cbp-button__icon" aria-hidden="true">
                <use xlink:href="/assets/uswds/img/sprite.svg#edit"></use>
              </svg>
              Bulk Edit
            </button>
            <button class="cbp-button cbp-button--outline cbp-button--small">
              <svg class="cbp-button__icon" aria-hidden="true">
                <use xlink:href="/assets/uswds/img/sprite.svg#file_download"></use>
              </svg>
              Export
            </button>
          </div>
        </div>
      </div>
      <div class="cbp-table-header__right">
        <div class="cbp-table-view-options">
          <button 
            class="cbp-view-toggle" 
            [class.cbp-view-toggle--active]="isTableView()"
            title="Table view"
            (click)="setViewMode('table')"
          >
            <svg class="cbp-view-icon" aria-hidden="true">
              <use xlink:href="/assets/uswds/img/sprite.svg#view_list"></use>
            </svg>
          </button>
          <button 
            class="cbp-view-toggle" 
            [class.cbp-view-toggle--active]="isCardView()"
            title="Card view"
            (click)="setViewMode('card')"
          >
            <svg class="cbp-view-icon" aria-hidden="true">
              <use xlink:href="/assets/uswds/img/sprite.svg#view_module"></use>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="cbp-loading-state">
      <div class="cbp-spinner-container">
        <div class="cbp-spinner" role="status" aria-label="Loading countries">
          <div class="cbp-spinner-inner"></div>
        </div>
        <p class="cbp-loading-text">Loading countries...</p>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && countries.length === 0" class="cbp-empty-container">
      <div class="cbp-empty-state">
        <svg class="cbp-empty-icon" aria-hidden="true">
          <use xlink:href="/assets/uswds/img/sprite.svg#search_off"></use>
        </svg>
        <h4 class="cbp-empty-title">No Countries Found</h4>
        <p class="cbp-empty-text">Try adjusting your search criteria or filters, or add a new country to get started.</p>
        <button class="cbp-button cbp-button--primary" (click)="addCountry()">
          <svg class="cbp-button__icon" aria-hidden="true">
            <use xlink:href="/assets/uswds/img/sprite.svg#add"></use>
          </svg>
          Add First Country
        </button>
      </div>
    </div>

    <!-- Table View -->
    <div class="cbp-table-wrapper" *ngIf="!loading && countries.length > 0 && isTableView()">
      <table class="cbp-table">
        <thead class="cbp-table-head">
          <tr class="cbp-table-row cbp-table-row--header">
            <th class="cbp-table-cell cbp-table-cell--checkbox">
              <div class="cbp-checkbox-wrapper">
                <input 
                  class="cbp-checkbox" 
                  id="select-all" 
                  type="checkbox" 
                  [(ngModel)]="selectAll"
                  (change)="toggleSelectAll()"
                  [disabled]="countries.length === 0"
                />
                <label class="cbp-checkbox-label" for="select-all">
                  <span class="usa-sr-only">Select all</span>
                </label>
              </div>
            </th>
            <th class="cbp-table-cell cbp-table-cell--sortable" (click)="sortBy('countryCode')">
              <div class="cbp-sort-header">
                <span class="cbp-sort-text">Country Code</span>
                <svg class="cbp-sort-icon" aria-hidden="true">
                  <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getSortIcon('countryCode')"></use>
                </svg>
              </div>
            </th>
            <th class="cbp-table-cell cbp-table-cell--sortable" (click)="sortBy('countryName')">
              <div class="cbp-sort-header">
                <span class="cbp-sort-text">Country Name</span>
                <svg class="cbp-sort-icon" aria-hidden="true">
                  <use [attr.xlink:href]="'/assets/uswds/img/sprite.svg#' + getSortIcon('countryName')"></use>
                </svg>
              </div>
            </th>
            <th class="cbp-table-cell">ISO2</th>
            <th class="cbp-table-cell">ISO3</th>
            <th class="cbp-table-cell">Numeric</th>
            <th class="cbp-table-cell">System</th>
            <th class="cbp-table-cell">Status</th>
            <th class="cbp-table-cell">Valid From</th>
            <th class="cbp-table-cell cbp-table-cell--actions">Actions</th>
          </tr>
        </thead>
        <tbody class="cbp-table-body">
          <!-- Enhanced Loading State -->
          <tr class="cbp-table-row cbp-table-row--loading" *ngIf="loading">
            <td colspan="10" class="cbp-table-cell cbp-table-cell--loading">
              <div class="cbp-loading-content">
                <div class="cbp-loading-spinner"></div>
                <span class="cbp-loading-text">Loading countries data...</span>
              </div>
            </td>
          </tr>
          
          <!-- Enhanced Empty State -->
          <tr class="cbp-table-row cbp-table-row--empty" *ngIf="!loading && countries.length === 0">
            <td colspan="10" class="cbp-table-cell cbp-table-cell--empty">
              <div class="cbp-empty-state">
                <svg class="cbp-empty-icon" aria-hidden="true">
                  <use xlink:href="/assets/uswds/img/sprite.svg#search_off"></use>
                </svg>
                <h4 class="cbp-empty-title">No Countries Found</h4>
                <p class="cbp-empty-text">Try adjusting your search criteria or filters, or add a new country to get started.</p>
                <button class="cbp-button cbp-button--primary" (click)="addCountry()">
                  <svg class="cbp-button__icon" aria-hidden="true">
                    <use xlink:href="/assets/uswds/img/sprite.svg#add"></use>
                  </svg>
                  Add First Country
                </button>
              </div>
            </td>
          </tr>
          
          <!-- Enhanced Data Rows -->
          <tr class="cbp-table-row cbp-table-row--data" *ngFor="let country of countries" 
              [class.cbp-table-row--selected]="isSelected(country.id)">
            <td class="cbp-table-cell cbp-table-cell--checkbox">
              <div class="cbp-checkbox-wrapper">
                <input 
                  class="cbp-checkbox" 
                  [id]="'select-' + country.id" 
                  type="checkbox" 
                  [checked]="isSelected(country.id)"
                  (change)="toggleSelection(country.id)"
                />
                <label class="cbp-checkbox-label" [for]="'select-' + country.id">
                  <span class="usa-sr-only">Select {{ country.countryName }}</span>
                </label>
              </div>
            </td>
            <td class="cbp-table-cell cbp-table-cell--code">
              <div class="cbp-country-code">{{ country.countryCode }}</div>
            </td>
            <td class="cbp-table-cell cbp-table-cell--primary">
              <div class="cbp-country-name">
                <div class="cbp-country-name-text">{{ country.countryName }}</div>
              </div>
            </td>
            <td class="cbp-table-cell cbp-table-cell--code">
              <span class="cbp-iso-code">{{ country.iso2Code }}</span>
            </td>
            <td class="cbp-table-cell cbp-table-cell--code">
              <span class="cbp-iso-code">{{ country.iso3Code }}</span>
            </td>
            <td class="cbp-table-cell cbp-table-cell--code">
              <span class="cbp-numeric-code">{{ country.numericCode }}</span>
            </td>
            <td class="cbp-table-cell">
              <span class="cbp-system-badge">{{ country.codeSystem }}</span>
            </td>
            <td class="cbp-table-cell">
              <div class="cbp-status-wrapper">
                <span 
                  class="cbp-status-badge"
                  [class.cbp-status-badge--active]="country.isActive"
                  [class.cbp-status-badge--inactive]="!country.isActive"
                >
                  <span class="cbp-status-indicator"></span>
                  {{ country.isActive ? 'Active' : 'Inactive' }}
                </span>
              </div>
            </td>
            <td class="cbp-table-cell cbp-table-cell--date">
              <span class="cbp-date-text">{{ formatDate(country.validFrom) }}</span>
            </td>
            <td class="cbp-table-cell cbp-table-cell--actions">
              <div class="cbp-action-buttons">
                <button 
                  class="cbp-action-button cbp-action-button--view"
                  (click)="viewCountry(country)"
                  title="View country details"
                >
                  <svg class="cbp-action-icon" aria-hidden="true">
                    <use xlink:href="/assets/uswds/img/sprite.svg#visibility"></use>
                  </svg>
                </button>
                <button 
                  class="cbp-action-button cbp-action-button--edit"
                  (click)="editCountry(country)"
                  title="Edit country"
                >
                  <svg class="cbp-action-icon" aria-hidden="true">
                    <use xlink:href="/assets/uswds/img/sprite.svg#edit"></use>
                  </svg>
                </button>
                <button 
                  class="cbp-action-button cbp-action-button--delete"
                  (click)="confirmDelete(country)"
                  title="Deactivate country"
                  *ngIf="country.isActive"
                >
                  <svg class="cbp-action-icon" aria-hidden="true">
                    <use xlink:href="/assets/uswds/img/sprite.svg#delete"></use>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Card View -->
    <div *ngIf="!loading && countries.length > 0 && isCardView()" class="cbp-cards-container">
      <div class="cbp-cards-grid">
        <div
          *ngFor="let country of countries; trackBy: trackByCountryId"
          class="cbp-port-card"
          [class.cbp-port-card--inactive]="!country.isActive"
        >
          <div class="cbp-card-header">
            <div class="cbp-card-select">
              <input
                type="checkbox"
                class="cbp-checkbox"
                [checked]="isSelected(country.id)"
                (change)="toggleSelection(country.id)"
                [attr.aria-label]="'Select ' + country.countryName"
              >
            </div>
            <div class="cbp-card-status">
              <span class="cbp-status-badge"
                    [class.cbp-status-badge--active]="country.isActive"
                    [class.cbp-status-badge--inactive]="!country.isActive">
                {{ country.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>

          <div class="cbp-card-content">
            <div class="cbp-card-title">
              <h3>{{ country.countryName }}</h3>
              <span class="cbp-card-code">{{ country.countryCode }}</span>
            </div>

            <div class="cbp-card-info">
              <div class="cbp-info-row">
                <svg class="cbp-info-icon" aria-hidden="true">
                  <use xlink:href="/assets/uswds/img/sprite.svg#flag"></use>
                </svg>
                <span>ISO: {{ country.iso2Code }} / {{ country.iso3Code }}</span>
              </div>

              <div class="cbp-info-row" *ngIf="country.numericCode">
                <svg class="cbp-info-icon" aria-hidden="true">
                  <use xlink:href="/assets/uswds/img/sprite.svg#tag"></use>
                </svg>
                <span>Numeric: {{ country.numericCode }}</span>
              </div>

              <div class="cbp-info-row">
                <svg class="cbp-info-icon" aria-hidden="true">
                  <use xlink:href="/assets/uswds/img/sprite.svg#account_balance"></use>
                </svg>
                <span>System: {{ country.codeSystem || 'ISO3166-1' }}</span>
              </div>

              <div class="cbp-info-row">
                <svg class="cbp-info-icon" aria-hidden="true">
                  <use xlink:href="/assets/uswds/img/sprite.svg#calendar_today"></use>
                </svg>
                <span>Valid from: {{ formatDate(country.validFrom) }}</span>
              </div>

              <div class="cbp-info-row" *ngIf="country.validTo">
                <svg class="cbp-info-icon" aria-hidden="true">
                  <use xlink:href="/assets/uswds/img/sprite.svg#event_busy"></use>
                </svg>
                <span>Valid to: {{ formatDate(country.validTo) }}</span>
              </div>
            </div>
          </div>

          <div class="cbp-card-actions">
            <button
              class="cbp-button cbp-button--sm cbp-button--secondary"
              (click)="viewCountry(country)"
            >
              View Details
            </button>
            <button
              class="cbp-button cbp-button--sm cbp-button--outline"
              (click)="editCountry(country)"
            >
              Edit
            </button>
            <button
              class="cbp-button cbp-button--sm cbp-button--danger"
              (click)="confirmDelete(country)"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

      <!-- Pagination Controls -->
      <div class="display-flex flex-justify flex-align-center margin-top-4">
        <!-- Page Size Selector -->
        <div class="display-flex flex-align-center margin-right-3">
          <label for="pageSize" class="margin-right-1">Items per page:</label>
          <select
            id="pageSize"
            class="usa-select width-auto"
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange(+pageSize)"
          >
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
          </select>
        </div>

        <!-- Pagination Navigation -->
        <nav aria-label="Pagination" class="usa-pagination flex-1" *ngIf="totalElements > 0">
          <ul class="usa-pagination__list" *ngIf="totalPages > 1">
          <li class="usa-pagination__item usa-pagination__arrow">
            <a 
              href="javascript:void(0);" 
              class="usa-pagination__link"
              [class.usa-pagination__link--disabled]="currentPage === 0"
              (click)="goToPage(currentPage - 1)"
              aria-label="Previous page"
            >
              <svg class="usa-icon" aria-hidden="true" role="img">
                <use xlink:href="/assets/uswds/img/sprite.svg#navigate_before"></use>
              </svg>
              <span class="usa-pagination__link-text">Previous</span>
            </a>
          </li>

          <li class="usa-pagination__item usa-pagination__page-no" *ngFor="let page of pageNumbers">
            <a 
              href="javascript:void(0);" 
              class="usa-pagination__button"
              [class.usa-current]="page === currentPage"
              (click)="goToPage(page)"
              [attr.aria-label]="'Page ' + (page + 1)"
            >
              {{ page + 1 }}
            </a>
          </li>

          <li class="usa-pagination__item usa-pagination__arrow">
            <a 
              href="javascript:void(0);" 
              class="usa-pagination__link"
              [class.usa-pagination__link--disabled]="currentPage === totalPages - 1"
              (click)="goToPage(currentPage + 1)"
              aria-label="Next page"
            >
              <span class="usa-pagination__link-text">Next</span>
              <svg class="usa-icon" aria-hidden="true" role="img">
                <use xlink:href="/assets/uswds/img/sprite.svg#navigate_next"></use>
              </svg>
            </a>
          </li>
        </ul>
        <div class="usa-pagination__counter">
          Showing {{ (currentPage * pageSize) + 1 }} - {{ getMinValue((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }} results
        </div>
      </nav>
    </div>
    </div>
  </div>

<!-- Country Details/Edit Modal -->
<div *ngIf="showModal" class="cbp-modal-overlay cbp-fade-in" (click)="closeModal()">
  <div class="cbp-modal cbp-slide-up" (click)="$event.stopPropagation()" role="dialog" aria-modal="true" [attr.aria-labelledby]="isEditMode ? 'modal-title-edit' : 'modal-title-view'">
    <div class="cbp-modal-header">
      <h2 class="cbp-modal-title" [id]="isEditMode ? 'modal-title-edit' : 'modal-title-view'">
        {{ isEditMode ? (selectedCountry?.id ? 'Edit Country' : 'Add New Country') : 'Country Details' }}
      </h2>
      <button class="cbp-modal-close" (click)="closeModal()" aria-label="Close modal">
        <svg class="cbp-modal-close-icon" aria-hidden="true">
          <use xlink:href="/assets/uswds/img/sprite.svg#close"></use>
        </svg>
      </button>
    </div>
    
    <div class="cbp-modal-content">
      <div *ngIf="formErrors.general" class="cbp-alert cbp-alert--error margin-bottom-3">
        <div class="cbp-alert__content">
          <svg class="cbp-alert__icon" aria-hidden="true">
            <use xlink:href="/assets/uswds/img/sprite.svg#error"></use>
          </svg>
          <div class="cbp-alert__body">
            <p class="cbp-alert__text">{{ formErrors.general }}</p>
          </div>
        </div>
      </div>

      <form *ngIf="selectedCountry" class="cbp-form">
        <div class="cbp-form-section">
          <h3 class="cbp-form-section-title">Basic Information</h3>
          
          <div class="cbp-form-row">
            <div class="cbp-form-group">
              <label class="cbp-label" for="country-name">
                Country Name *
              </label>
              <input
                id="country-name"
                class="cbp-input"
                [class.cbp-input--error]="formErrors.countryName"
                type="text"
                [(ngModel)]="selectedCountry.countryName"
                [readonly]="!isEditMode"
                name="countryName"
                required
              />
              <div *ngIf="formErrors.countryName" class="cbp-error-message">
                {{ formErrors.countryName }}
              </div>
            </div>
            
            <div class="cbp-form-group">
              <label class="cbp-label" for="country-code">
                Country Code *
              </label>
              <input
                id="country-code"
                class="cbp-input"
                [class.cbp-input--error]="formErrors.countryCode"
                type="text"
                [(ngModel)]="selectedCountry.countryCode"
                [readonly]="!isEditMode"
                name="countryCode"
                required
              />
              <div *ngIf="formErrors.countryCode" class="cbp-error-message">
                {{ formErrors.countryCode }}
              </div>
            </div>
          </div>

          <div class="cbp-form-row">
            <div class="cbp-form-group">
              <label class="cbp-label" for="iso2-code">
                ISO2 Code *
              </label>
              <input
                id="iso2-code"
                class="cbp-input"
                [class.cbp-input--error]="formErrors.iso2Code"
                type="text"
                maxlength="2"
                [(ngModel)]="selectedCountry.iso2Code"
                [readonly]="!isEditMode"
                name="iso2Code"
                required
              />
              <div *ngIf="formErrors.iso2Code" class="cbp-error-message">
                {{ formErrors.iso2Code }}
              </div>
            </div>
            
            <div class="cbp-form-group">
              <label class="cbp-label" for="iso3-code">
                ISO3 Code *
              </label>
              <input
                id="iso3-code"
                class="cbp-input"
                [class.cbp-input--error]="formErrors.iso3Code"
                type="text"
                maxlength="3"
                [(ngModel)]="selectedCountry.iso3Code"
                [readonly]="!isEditMode"
                name="iso3Code"
                required
              />
              <div *ngIf="formErrors.iso3Code" class="cbp-error-message">
                {{ formErrors.iso3Code }}
              </div>
            </div>
          </div>

          <div class="cbp-form-row">
            <div class="cbp-form-group">
              <label class="cbp-label" for="numeric-code">
                Numeric Code
              </label>
              <input
                id="numeric-code"
                class="cbp-input"
                [class.cbp-input--error]="formErrors.numericCode"
                type="text"
                maxlength="3"
                [(ngModel)]="selectedCountry.numericCode"
                [readonly]="!isEditMode"
                name="numericCode"
              />
              <div *ngIf="formErrors.numericCode" class="cbp-error-message">
                {{ formErrors.numericCode }}
              </div>
            </div>
            
            <div class="cbp-form-group">
              <label class="cbp-label" for="code-system-modal">
                Code System
              </label>
              <select
                id="code-system-modal"
                class="cbp-select"
                [(ngModel)]="selectedCountry.codeSystem"
                [disabled]="!isEditMode || selectedCountry.id"
                name="codeSystem"
              >
                <option *ngFor="let system of availableCodeSystems" [value]="system">
                  {{ system }}
                </option>
              </select>
            </div>
          </div>
        </div>

        <div class="cbp-form-section">
          <h3 class="cbp-form-section-title">Status & Validation</h3>
          
          <div class="cbp-form-row">
            <div class="cbp-form-group">
              <div class="cbp-checkbox-wrapper">
                <input
                  id="is-active"
                  class="cbp-checkbox"
                  type="checkbox"
                  [(ngModel)]="selectedCountry.isActive"
                  [disabled]="!isEditMode"
                  name="isActive"
                />
                <label class="cbp-checkbox-label" for="is-active">
                  Country is active
                </label>
              </div>
            </div>
          </div>

          <div class="cbp-form-row" *ngIf="!isEditMode && selectedCountry.id">
            <div class="cbp-form-group">
              <label class="cbp-label">Valid From</label>
              <div class="cbp-readonly-field">{{ formatDate(selectedCountry.validFrom) }}</div>
            </div>
            
            <div class="cbp-form-group" *ngIf="selectedCountry.validTo">
              <label class="cbp-label">Valid To</label>
              <div class="cbp-readonly-field">{{ formatDate(selectedCountry.validTo) }}</div>
            </div>
          </div>

          <div class="cbp-form-row" *ngIf="!isEditMode && selectedCountry.id">
            <div class="cbp-form-group">
              <label class="cbp-label">Recorded At</label>
              <div class="cbp-readonly-field">{{ formatDate(selectedCountry.recordedAt) }}</div>
            </div>
            
            <div class="cbp-form-group">
              <label class="cbp-label">Version</label>
              <div class="cbp-readonly-field">{{ selectedCountry.version }}</div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="cbp-modal-footer">
      <button class="cbp-button cbp-button--secondary" (click)="closeModal()">
        {{ isEditMode ? 'Cancel' : 'Close' }}
      </button>
      <button 
        *ngIf="isEditMode"
        class="cbp-button cbp-button--primary"
        (click)="saveCountry()"
      >
        {{ selectedCountry?.id ? 'Update Country' : 'Create Country' }}
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="usa-modal" [class.is-visible]="showDeleteConfirm" *ngIf="showDeleteConfirm">
  <div class="usa-modal__content">
    <div class="usa-modal__header">
      <h2 class="usa-modal__heading">Confirm Deactivation</h2>
    </div>
    
    <div class="usa-modal__main">
      <p>
        Are you sure you want to deactivate <strong>{{ countryToDelete?.countryName }}</strong> 
        ({{ countryToDelete?.countryCode }})? This action will mark the country as inactive 
        in the bitemporal system.
      </p>
      <p class="text-base margin-top-2">
        Note: The country data will be preserved for historical reference and can be reactivated later if needed.
      </p>
    </div>

    <div class="cbp-modal-footer">
      <button class="cbp-button cbp-button--secondary" (click)="cancelDelete()">
        Cancel
      </button>
      <button class="cbp-button cbp-button--danger" (click)="deleteCountry()">
        Deactivate Country
      </button>
    </div>
  </div>
</div>